<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Engineering Tools v4.3 - Universal Arsenal</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; background-color: #1a1a1a; color: white; margin: 0; padding: 20px; }
        .container { background: #2d2d2d; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; border: 1px solid #444; width: 450px; }
        button { display: block; width: 100%; margin: 10px 0; padding: 12px; font-size: 14px; font-weight: bold; cursor: pointer; border: none; border-radius: 8px; background-color: #007bff; color: white; transition: 0.3s; }
        button.new-tool { background-color: #ff9900; }
        button.audit-tool { background-color: #8a2be2; }
        button.architect-tool { background-color: #28a745; border: 1px solid #fff; }
        button.save-btn { background-color: #555; margin-top: 15px; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        h2 { margin-bottom: 20px; color: #00cc66; text-transform: uppercase; font-size: 22px; }
        .arsenal-section { margin-top: 25px; padding: 15px; background: #222; border-radius: 10px; border: 1px dashed #555; }
        .arsenal-section h4 { margin: 0 0 10px 0; color: #ff9900; font-size: 14px; text-transform: uppercase; }
        .device-list { text-align: left; margin-bottom: 10px; font-size: 13px; }
        .device-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #444; }
        .delete-btn { color: #ff4444; cursor: pointer; padding: 5px 10px; font-weight: bold; background: rgba(255,68,68,0.1); border-radius: 4px; }
        .footer { font-size: 10px; color: #666; margin-top: 20px; text-transform: uppercase; }
        .warning { color: #ff4444; font-weight: bold; margin-top: 10px; border: 1px solid #ff4444; padding: 5px; border-radius: 5px; font-size: 13px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Engineering Tools v4.3</h2>
    
    <button onclick="calcPowerbank()">1. –ó–∞—Ä—è–¥–∫–∞ –ü–ë (–î–∏–Ω–∞–º—ñ–∫–∞)</button>
    <button onclick="calcLiIon()">2. –ó–∞—Ä—è–¥–∫–∞ Li-ion (0.001)</button>
    <button class="new-tool" onclick="calcWorkTime()">3. –ß–∞—Å —Ä–æ–±–æ—Ç–∏ (Pro Mode)</button>
    <button class="audit-tool" onclick="calcLightTime()">4. –°–∫—ñ–ª—å–∫–∏ –±—É–ª–æ —Å–≤—ñ—Ç–ª–æ?</button>
    <button class="architect-tool" onclick="calcChargeStats()">5. –ê–Ω–∞–ª—ñ–∑: –°–∫—ñ–ª—å–∫–∏ –∑–∞—Ä—è–¥–æ–∫ —ñ % –ø–± –∑–∞–ª–∏—à–∏—Ç—å—Å—è</button>
    <button class="new-tool" onclick="calcFlashlight()">6. –†–æ–±–æ—Ç–∞ –ª—ñ—Ö—Ç–∞—Ä–∏–∫–∞</button>

    <div id="statusArea"></div>
    <div id="saveArea" style="display:none;">
        <button class="save-btn" onclick="downloadReport()">üíæ –ó–ê–í–ê–ù–¢–ê–ñ–ò–¢–ò –ó–í–Ü–¢ (.txt)</button>
    </div>

    <div class="arsenal-section">
        <h4>üì¶ –ú–Ü–ô –ê–†–°–ï–ù–ê–õ</h4>
        <div id="deviceList" class="device-list">–ê—Ä—Å–µ–Ω–∞–ª –ø–æ—Ä–æ–∂–Ω—ñ–π</div>
        <button onclick="addDeviceToStorage()" style="background:#444; font-size: 11px; padding: 8px;">+ –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π</button>
    </div>

    <div class="footer">–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ –º–æ–¥–µ–ª—å –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–∞ v4.3</div>
</div>

<script>
let lastReport = "";

// --- –†–û–ë–û–¢–ê –ó –ü–ê–ú'–Ø–¢–¢–Æ ---
function getStoredDevices() {
    const devices = localStorage.getItem('eng_tools_v4_data');
    return devices ? JSON.parse(devices) : [];
}

function renderDeviceList() {
    const listDiv = document.getElementById('deviceList');
    const devices = getStoredDevices();
    if (devices.length === 0) { listDiv.innerHTML = "–ê—Ä—Å–µ–Ω–∞–ª –ø–æ—Ä–æ–∂–Ω—ñ–π"; return; }
    listDiv.innerHTML = devices.map((d, i) => `
        <div class="device-item">
            <span><b>${d.name}</b> (${d.mah}mAh | ${d.watts}W)</span>
            <span class="delete-btn" onclick="deleteDevice(${i})">‚úï</span>
        </div>
    `).join('');
}

function addDeviceToStorage() {
    let name = prompt("–ù–∞–∑–≤–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é:");
    if (!name) return;
    let mah = Number(prompt("–Ñ–º–Ω—ñ—Å—Ç—å (mAh):"));
    let watts = Number(prompt("–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (W) - –∑–∞—Ä—è–¥–∫–∏ –∞–±–æ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è:"));
    let devices = getStoredDevices();
    devices.push({ name, mah, wh: (mah/1000)*3.7, watts });
    localStorage.setItem('eng_tools_v4_data', JSON.stringify(devices));
    renderDeviceList();
}

function deleteDevice(index) {
    let devices = getStoredDevices();
    devices.splice(index, 1);
    localStorage.setItem('eng_tools_v4_data', JSON.stringify(devices));
    renderDeviceList();
}

// –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä –ø—Ä–∏—Å—Ç—Ä–æ—é
function selectDevice() {
    let devices = getStoredDevices();
    if (devices.length > 0 && confirm("–í–∏–±—Ä–∞—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π –∑ –ê—Ä—Å–µ–Ω–∞–ª—É?")) {
        let options = devices.map((d, i) => `${i}: ${d.name}`).join('\n');
        let choice = prompt("–í–∏–±–µ—Ä—ñ—Ç—å –Ω–æ–º–µ—Ä:\n" + options);
        return devices[choice] || null;
    }
    return null;
}

// --- –£–¢–ò–õ–Ü–¢–ò ---
function formatTime(totalMinutes) {
    if (totalMinutes <= 0 || isNaN(totalMinutes)) return "0 —Ö–≤.";
    let h = Math.floor(totalMinutes / 60);
    let m = Math.round(totalMinutes % 60);
    return h > 0 ? `${h} –≥–æ–¥. ${m} —Ö–≤.` : `${m} —Ö–≤.`;
}

// --- –§–£–ù–ö–¶–Ü–á ---
//–ö–Ω–æ–ø–∫–∞ 1
function calcPowerbank() {
    let dev = selectDevice();
    let mah = dev ? dev.mah : Number(prompt("–Ñ–º–Ω—ñ—Å—Ç—å –ü–ë (mAh):"));
    let wh = dev ? dev.wh : (mah / 1000) * 3.7;
    let watts = dev ? dev.watts : Number(prompt("–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∑–∞—Ä—è–¥–∫–∏ (W):"));
    
    let p = Number(prompt("–ü–æ—Ç–æ—á–Ω–∏–π % –∑–∞—Ä—è–¥—É:"));
    let totalMinutes = 0;
    for (let i = p; i < 100; i++) {
        let eff = watts * 0.85;
        if (i >= 80 && i < 90) eff *= 0.7;
        else if (i >= 90) eff *= 0.35;
        totalMinutes += ((wh / 100) / eff) * 60;
    }
    alert(`–ß–∞—Å –∑–∞—Ä—è–¥–∫–∏: ${formatTime(totalMinutes)}`);
}
//–ö–Ω–æ–ø–∫–∞ 3
function calcWorkTime() {
    let batteryWh = 0;

    // 1. –ü–∏—Ç–∞—î–º–æ –ø—Ä–æ Wh
    if (confirm("–ß–∏ –∑–Ω–∞—î—Ç–µ –≤–∏ —î–º–Ω—ñ—Å—Ç—å –±–∞—Ç–∞—Ä–µ—ó —É Wh?")) {
        batteryWh = Number(prompt("–í–≤–µ–¥—ñ—Ç—å Wh –≤–∞—à–æ—ó –±–∞—Ç–∞—Ä–µ—ó:"));
    } else {
        // –Ø–∫—â–æ –Ω–µ –∑–Ω–∞—î - —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ —á–µ—Ä–µ–∑ mAh
        let mah = Number(prompt("–í–≤–µ–¥—ñ—Ç—å —î–º–Ω—ñ—Å—Ç—å —É mAh:"));
        let volts = Number(prompt("–í–≤–µ–¥—ñ—Ç—å –Ω–∞–ø—Ä—É–≥—É –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞ (–∑–∞–∑–≤–∏—á–∞–π 3.7 –¥–ª—è –ø–∞–≤–µ—Ä–±–∞–Ω–∫—ñ–≤):", "3.7"));
        batteryWh = (mah * volts) / 1000;
    }

    // –†–µ—à—Ç–∞ –ª–æ–≥—ñ–∫–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è
    let maxPower = Number(prompt("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –≤–∏—Ö—ñ–¥–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –≤–∞—à–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é (W):"));
    let count = Number(prompt("–°–∫—ñ–ª—å–∫–∏ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ?"));
    let totalW = 0;

    for (let i = 1; i <= count; i++) {
        if (confirm(`–ü—Ä–∏—Å—Ç—Ä—ñ–π ‚Ññ${i}: –ó–Ω–∞—î—Ç–µ –π–æ–≥–æ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —É –í–∞—Ç–∞—Ö (W)?`)) {
            totalW += Number(prompt(`–í–≤–µ–¥—ñ—Ç—å –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (W) –ø—Ä–∏—Å—Ç—Ä–æ—é ‚Ññ${i}:`));
        } else {
            let v = Number(prompt(`–í–≤–µ–¥—ñ—Ç—å –Ω–∞–ø—Ä—É–≥—É (V) –ø—Ä–∏—Å—Ç—Ä–æ—é ‚Ññ${i}:`));
            let a = Number(prompt(`–í–≤–µ–¥—ñ—Ç—å —Å—Ç—Ä—É–º (A) –ø—Ä–∏—Å—Ç—Ä–æ—é ‚Ññ${i}:`));
            totalW += v * a;
        }
    }

    let totalMinutes = (batteryWh / totalW) * 60;
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    if (totalW > maxPower) {
        document.getElementById('statusArea').innerHTML = `<div class="warning">‚ö†Ô∏è –£–í–ê–ì–ê: –ü–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è! –°–ø–æ–∂–∏–≤–∞–Ω–Ω—è (${totalW}W) –±—ñ–ª—å—à–µ –ª—ñ–º—ñ—Ç—É (${maxPower}W)</div>`;
    } else {
        document.getElementById('statusArea').innerHTML = "";
    }

    lastReport = `–ó–í–Ü–¢: –ß–ê–° –†–û–ë–û–¢–ò (Pro Mode)\n-------------------\n–ï–Ω–µ—Ä–≥—ñ—è –±–∞—Ç–∞—Ä–µ—ó: ${batteryWh.toFixed(2)} Wh\n–°—É–º–∞—Ä–Ω–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è: ${totalW.toFixed(2)} W\n–ß–∞—Å —Ä–æ–±–æ—Ç–∏: ${formatTime(totalMinutes)}`;
    
    alert(lastReport);
    document.getElementById('saveArea').style.display = "block";
}
//–ö–Ω–æ–ø–∫–∞ 4
function calcLightTime() {
    let dev = selectDevice();
    let wh = dev ? dev.wh : (Number(prompt("–Ñ–º–Ω—ñ—Å—Ç—å –ü–ë (mAh):")) / 1000) * 3.7;
    let p1 = Number(prompt("% —Å–ø–æ—á–∞—Ç–∫—É:"));
    let p2 = Number(prompt("% –≤ –∫—ñ–Ω—Ü—ñ:"));
    let w = dev ? dev.watts : Number(prompt("–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∑–∞—Ä—è–¥–∫–∏ (W):"));
    let mins = ((wh * (p2 - p1) / 100) / (w * 0.85)) * 60;
    alert(`–°–≤—ñ—Ç–ª–æ –±—É–ª–æ: ${formatTime(mins)}`);
}

// 5. –¢–í–û–Ø –ü–û–í–ù–ê –ê–†–•–Ü–¢–ï–ö–¢–£–†–ê 3.0 (11 –∫—Ä–æ–∫—ñ–≤)
function calcChargeStats() {
    let p1 = confirm("–ó–Ω–∞—î—Ç–µ Wh –ø–∞–≤–µ—Ä–±–∞–Ω–∫–∞?") ? Number(prompt("1. Wh –ø–∞–≤–µ—Ä–±–∞–Ω–∫–∞:")) : (Number(prompt("1. mAh –ø–∞–≤–µ—Ä–±–∞–Ω–∫–∞:")) / 1000) * 3.7;
    let p2 = Number(prompt("2. –Ø–∫–∏–π –∑–∞—Ä–∞–∑ % –∑–∞—Ä—è–¥—É –ü–ë?"));
    let p3 = p1 * (p2 / 100); // –ï–Ω–µ—Ä–≥—ñ—è –∑–∞—Ä–∞–∑
    let p4 = Number(prompt("4. –°–∫—ñ–ª—å–∫–∏ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ —Ö–æ—á–µ—Ç–µ –∑–∞—Ä—è–¥–∏—Ç–∏?"));
    let totalNeededFromBank = 0;

    for (let i = 1; i <= p4; i++) {
        let p5 = confirm(`–ü—Ä–∏—Å—Ç—Ä—ñ–π ‚Ññ${i}: –ó–Ω–∞—î—Ç–µ Wh?`) ? Number(prompt("5. –ü–æ–≤–Ω–∞ —î–º–Ω—ñ—Å—Ç—å Wh:")) : (Number(prompt("5. –ü–æ–≤–Ω–∞ —î–º–Ω—ñ—Å—Ç—å mAh:")) / 1000) * 3.7;
        let p6 = Number(prompt(`6. –ü–æ—Ç–æ—á–Ω–∏–π % –∑–∞—Ä—è–¥—É –ø—Ä–∏—Å—Ç—Ä–æ—é ‚Ññ${i}?`));
        let p7 = p5 * (p6 / 100); // –°–∫—ñ–ª—å–∫–∏ –≤–∂–µ —î
        let p8 = p5 - p7; // –ó–∞–ª–∏—à–æ–∫ (—Å–∫—ñ–ª—å–∫–∏ —Ç—Ä–µ–±–∞ –¥–æ–¥–∞—Ç–∏)
        totalNeededFromBank += (p8 / 0.85); // –°—É–º—É—î–º–æ –∑ –ö–ö–î
    }

    let p9 = p3 - totalNeededFromBank; // –ó–∞–ª–∏—à–æ–∫ –Ω–∞ –ü–ë —É Wh
    let p10 = (p9 / p1) * 100; // –ó–∞–ª–∏—à–æ–∫ —É %

    if (p9 < 0) {
        lastReport = `–ó–í–Ü–¢: –ù–ï –í–ò–°–¢–ê–ß–ò–¢–¨\n–ë—Ä–∞–∫: ${Math.abs(p9).toFixed(2)} Wh\n–ü–ë –≤–∏–º–∫–Ω–µ—Ç—å—Å—è —Ä–∞–Ω—ñ—à–µ.`;
        document.getElementById('statusArea').innerHTML = `<div class="warning">‚ö†Ô∏è –ë—Ä–∞–∫—É—î –µ–Ω–µ—Ä–≥—ñ—ó –¥–ª—è –ø–æ–≤–Ω–æ—ó –∑–∞—Ä—è–¥–∫–∏!</div>`;
    } else {
        let times = p3 / (totalNeededFromBank / p4);
        lastReport = `–ó–í–Ü–¢: –£–°–ü–Ü–®–ù–û\n–ó–∞–ª–∏—à–æ–∫ —É –ü–ë: ${p9.toFixed(2)} Wh\n–ó–∞–ª–∏—à–æ–∫ —É %: ${p10.toFixed(1)}%\n–ú–æ–∂–Ω–∞ –∑–∞—Ä—è–¥–∏—Ç–∏ —Ç–∞–∫–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤: ${times.toFixed(1)} —Ä–∞–∑—ñ–≤.`;
        document.getElementById('statusArea').innerHTML = "";
    }
    alert(lastReport);
    document.getElementById('saveArea').style.display = "block";
}

function downloadReport() {
    const blob = new Blob([lastReport], { type: 'text/plain;charset=utf-8' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url; link.download = `Engineering_Report.txt`;
    document.body.appendChild(link); link.click(); document.body.removeChild(link);
}
//–ö–Ω–æ–ø–∫–∞ 6
function calcFlashlight() {
    let dev = selectDevice();
    let wh = dev ? dev.wh : (Number(prompt("mAh –ª—ñ—Ö—Ç–∞—Ä–∏–∫–∞:")) / 1000) * 3.7;
    let lm = Number(prompt("–õ—é–º–µ–Ω–∏ (lm):"));
    alert(`–ß–∞—Å —Ä–æ–±–æ—Ç–∏: ${formatTime((wh / (lm/100)) * 60)}`);
}
//–ö–Ω–æ–ø–∫–∞ 2
function calcLiIon() {
    let E = Number(prompt("mAh –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞:"));
    let U = Number(prompt("–ù–∞–ø—Ä—É–≥–∞ (V):"));
    let A = Number(prompt("–°—Ç—Ä—É–º (A):"));
    alert(`–ß–∞—Å: ${formatTime(((0.001*E*3.7)/(U*A))*60)}`);
}

renderDeviceList();
</script>
<p style="color: #666; font-size: 12px; margin-top: 20px;">
   –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –∑–∞ –ª–æ–≥—ñ–∫–æ—é –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–∞ (15 —Ä–æ–∫—ñ–≤). –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ —Ñ—ñ–∑–∏—á–Ω–∏—Ö –º–æ–¥–µ–ª—è—Ö Li-ion.
</p>

</body>
</html>